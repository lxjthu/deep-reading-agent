# Deep Reading Agent System

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºå­¦æœ¯è®ºæ–‡æ·±åº¦ç²¾è¯»è®¾è®¡çš„è‡ªåŠ¨åŒ– Agent ç³»ç»Ÿã€‚å®ƒæ¨¡æ‹Ÿäº†é¡¶çº§è®¡é‡ç»æµå­¦å®¶çš„é˜…è¯»ä¸åˆ†ææµç¨‹ï¼Œå°†ä¸€ç¯‡ PDF è®ºæ–‡è½¬åŒ–ä¸ºç»“æ„åŒ–ã€æ·±åº¦è§£æä¸”é€‚åˆ Obsidian çŸ¥è¯†ç®¡ç†çš„ Markdown æŠ¥å‘Šã€‚

## æ ¸å¿ƒå·¥ä½œæµ (Pipeline)

æ•´ä¸ªç³»ç»Ÿç”±äº”ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼ˆSkillsï¼‰ä¸²è”è€Œæˆï¼š

```mermaid
graph TD
    A[åŸå§‹ PDF] -->|Step 1: æ ¼å¼è½¬æ¢| B(é€é¡µ Raw Markdown)
    B -->|Step 2: æ‰¹é‡åˆ†æ| F(Excel æ±‡æ€»è¡¨)
    B -->|Step 3: ç»“æ„åŒ–åˆ‡åˆ†| C(åˆ†æ®µ Segmented Markdown)
    C -->|Step 4: æ·±åº¦ç²¾è¯»| D(åˆ†æ­¥æ·±åº¦æŠ¥å‘Š Step Reports)
    D -->|Step 5: çŸ¥è¯†å›¾è°±åŒ–| E(Obsidian Ready çŸ¥è¯†åº“)
    C -->|å¯é€‰: å‚è€ƒæ–‡çŒ®æŠ½å–| R(References Excel)
    R -->|å¯é€‰: å¼•ç”¨è¿½è¸ª| T(Citation Trace MD/Excel)

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style F fill:#ff9,stroke:#333,stroke-width:2px
    style E fill:#9f9,stroke:#333,stroke-width:2px
```

### 1. æ ¼å¼è½¬æ¢ (PDF to Raw Markdown)
- **ç›®æ ‡**: å°† PDF è½¬æ¢ä¸ºå¤§æ¨¡å‹å¯è¯»çš„çº¯æ–‡æœ¬ï¼ŒåŒæ—¶ä¿ç•™é¡µç ä¿¡æ¯ä»¥ä¾¿å®šä½ã€‚
- **å·¥å…·**: `anthropic-pdf-extract` (åŸºäº `pdfplumber`/`pypdf`)
- **è¾“å‡º**: `*_raw.md`

### 2. æ‰¹é‡åˆ†æä¸åˆ¶è¡¨ (Batch Analysis)
- **ç›®æ ‡**: å¿«é€Ÿæ‰«ææ–‡ä»¶å¤¹ï¼Œæå–æ ¸å¿ƒä¿¡æ¯ï¼ˆä¸»é¢˜ã€å˜é‡ã€ç»“è®ºã€Stataä»£ç ï¼‰ç”Ÿæˆ Excel å¯¹æ¯”è¡¨ã€‚
- **å·¥å…·**: `academic-pdf-analyzer` (LLM-Enhanced)
- **è¾“å‡º**: `analysis_results.xlsx` åŠ Markdown ç®€æŠ¥ã€‚

### 3. ç»“æ„åŒ–åˆ‡åˆ† (Structure Segmentation)
- **ç›®æ ‡**: è¿˜åŸè®ºæ–‡é€»è¾‘ç»“æ„ï¼ˆIntroduction, Data, Model ç­‰ï¼‰ã€‚
- **å·¥å…·**: `deepseek-segment` (æ¨è) / `kimi-pdf-raw-segmenter`
- **æ¨¡å¼é€‰æ‹©**:
  - **è¾¹ç•Œæ£€æµ‹æ¨¡å¼**ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰: LLM è¿”å›è¾¹ç•Œ â†’ æœ¬åœ°åˆ‡ç‰‡ï¼Œè‡ªåŠ¨éª¨æ¶ä¼˜åŒ–ï¼Œç¨³å®šå¿«é€Ÿ
  - **ç›´æ¥åˆ†ç‰‡æ¨¡å¼** (`--direct`): LLM ç›´æ¥è¿”å›å®Œæ•´ç« èŠ‚ï¼Œé€‚åˆå°æ–‡ä»¶ï¼ˆ<50é¡µï¼‰
- **è¾“å‡º**: `*_segmented.md`

> ğŸ’¡ **ä½¿ç”¨å»ºè®®**: é»˜è®¤æ¨¡å¼å·²ç»è¿‡éªŒè¯ï¼Œå‡†ç¡®ç‡ 95%+ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ã€‚ä»…åœ¨å¤„ç†å°æ–‡ä»¶æˆ–éœ€è¦æœ€é«˜ç²¾åº¦æ—¶ä½¿ç”¨ `--direct` æ¨¡å¼ã€‚

### 4. æ·±åº¦ç²¾è¯» (Deep Reading & Analysis)
- **ç›®æ ‡**: åƒ Daron Acemoglu çº§åˆ«çš„å®¡ç¨¿äººä¸€æ ·ï¼Œå¯¹è®ºæ–‡è¿›è¡Œæ‰¹åˆ¤æ€§åˆ†æã€‚
- **å·¥å…·**: `deep-reading-expert`
- **é€»è¾‘**: åˆ†æ­¥å¤„ç†ï¼ˆå…¨æ™¯æ‰«æ -> ç†è®º -> æ•°æ® -> å˜é‡ -> è¯†åˆ« -> ç»“æœ -> æ‰¹åˆ¤ï¼‰ã€‚
- **è¾“å‡º**: `Final_Deep_Reading_Report.md` åŠå„åˆ†æ­¥æŠ¥å‘Šã€‚

### 5. çŸ¥è¯†å›¾è°±åŒ– (Obsidian Integration)
- **ç›®æ ‡**: æ— ç¼æ¥å…¥ Obsidianï¼Œå®ç°å…ƒæ•°æ®æ£€ç´¢ä¸åŒå‘é“¾æ¥ã€‚
- **å·¥å…·**: `obsidian-metadata-injector` & `obsidian-dataview-summarizer`
- **è¾“å‡º**: åŒ…å« YAML å¤´ï¼ˆå«å†…å®¹æ‘˜è¦ï¼‰å’Œå¯¼èˆªé“¾æ¥çš„ Markdown æ–‡ä»¶ç¾¤ã€‚

### 6. ç¤¾ç§‘æ–‡çŒ®æ·±åº¦é˜…è¯» (Social Science Scholar)
- **ç›®æ ‡**: é’ˆå¯¹ç®¡ç†å­¦/ç¤¾ä¼šå­¦æ–‡çŒ®ï¼Œé‡‡ç”¨â€œå››å±‚é‡‘å­—å¡”â€æ¨¡å‹ï¼ˆèƒŒæ™¯-ç†è®º-é€»è¾‘-ä»·å€¼ï¼‰è¿›è¡Œæ·±åº¦æƒ…æŠ¥æå–ã€‚
- **å·¥å…·**: `social_science_analyzer.py`
- **ç‰¹ç‚¹**: 4+1+1 è¾“å‡ºç»“æ„ï¼ˆ4åˆ†å±‚MD + 1å…¨æ™¯MD + 1æ±‡æ€»Excelï¼‰ï¼Œå¼ºåˆ¶ä¸­æ–‡è¾“å‡ºï¼Œæ”¯æŒæ–‡æ¡£é—´åŒå‘è·³è½¬ã€‚

### 7. æ™ºèƒ½ç§‘ç ”åŠ©ç† (Smart Scholar) - **New!**
- **ç›®æ ‡**: è‡ªåŠ¨è¯†åˆ«è®ºæ–‡ç±»å‹ï¼Œæ™ºèƒ½è·¯ç”±è‡³æœ€ä½³åˆ†æå¼•æ“ã€‚
- **å…¥å£**: `smart_scholar.py` / `smart_scholar_lib.py`
- **é€»è¾‘**: 
  - **å®šé‡ (Quant)** -> è·¯ç”±è‡³ Deep Reading Expert (Acemoglu Mode)ã€‚
  - **å®šæ€§ (Qual)** -> è·¯ç”±è‡³ Social Science Scholar (4-Layer Model)ã€‚åŒ…æ‹¬æ–‡çŒ®ç»¼è¿° (Reviews)ã€ç†è®ºæ–‡ç« ç­‰ã€‚
  - **å¿½ç•¥ (Ignore)** -> è‡ªåŠ¨è·³è¿‡éç ”ç©¶æ€§æ–‡æ¡£ï¼ˆå¦‚å·é¦–è¯­ã€ä¹¦è¯„ã€ç›®å½•ç­‰ï¼‰ã€‚
- **é»˜è®¤ç­–ç•¥**: å½“åˆ†ç±»ä¸ç¡®å®šæˆ–å¤±è´¥æ—¶ï¼Œé»˜è®¤å›é€€åˆ° **QUAL** æ¨¡å¼ï¼ˆå¯¹ç»¼è¿°å’Œç†è®ºæ–‡ç« æ›´å‹å¥½ï¼‰ã€‚

### 8. çŠ¶æ€ç®¡ç†ä¸å»é‡ (State Manager) - **New!**
- **ç›®æ ‡**: æä¾›åŸºäºå†…å®¹å“ˆå¸Œçš„æŒä¹…åŒ–å»é‡èƒ½åŠ›ï¼Œè§£å†³æ–‡ä»¶åå˜æ›´æˆ–ç§»åŠ¨å¯¼è‡´çš„é‡å¤å¤„ç†é—®é¢˜ã€‚
- **æœºåˆ¶**: 
  - **MD5 å†…å®¹å“ˆå¸Œ**: æ— è®ºæ–‡ä»¶åå¦‚ä½•å˜åŒ–ï¼Œåªè¦å†…å®¹ä¸å˜ï¼Œç³»ç»Ÿå°±èƒ½è¯†åˆ«ã€‚
  - **æŒä¹…åŒ–è´¦æœ¬**: çŠ¶æ€è®°å½•åœ¨ `processed_papers.json` ä¸­ã€‚
  - **é€’å½’æœç´¢**: `run_batch_pipeline.py` æ”¯æŒé€’å½’æ‰«æå­ç›®å½•ã€‚

### é™„åŠ èƒ½åŠ›ï¼šå‚è€ƒæ–‡çŒ®æŠ½å–ä¸å¼•ç”¨è¿½è¸ª (References & Citation Tracing)
- **ç›®æ ‡**: ä»è®ºæ–‡åŸæ–‡ä¸­æŠ½å–â€œå‚è€ƒæ–‡çŒ®åˆ—è¡¨â€ï¼Œå¹¶åœ¨æ­£æ–‡ä¸­åå‘å®šä½æ¯æ¡å‚è€ƒæ–‡çŒ®çš„å¼•ç”¨ä½ç½®ã€‚
- **å…¥å£è„šæœ¬**:
  - å‚è€ƒæ–‡çŒ®æŠ½å–ï¼š`extract_references.py` / `run_reference_extractor.ps1`
  - å¼•ç”¨è¿½è¸ªï¼š`citation_tracer.py` / `run_citation_tracer.ps1`
- **è¾“å‡º**ï¼ˆä½äº `references/`ï¼Œé€šå¸¸ä¸æäº¤ Gitï¼‰:
  - `*_references.xlsx`ï¼šç»“æ„åŒ–å‚è€ƒæ–‡çŒ®è¡¨
  - `*_references_with_citations.xlsx`ï¼šåœ¨å‚è€ƒæ–‡çŒ®è¡¨ä¸Šè¿½åŠ å¼•ç”¨æ¬¡æ•°ä¸ä¸Šä¸‹æ–‡
  - `*_references_citation_trace.md`ï¼šæŒ‰å‚è€ƒæ–‡çŒ®åºå·è¾“å‡ºçš„å¯è¯»è¿½è¸ªæ—¥å¿—

## å¿«é€Ÿå¼€å§‹

è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œå‘½ä»¤è¯´æ˜ï¼Œè¯·å‚é˜… **[å·¥ä½œæµæ‰‹å†Œ (Workflow Guide)](README_WORKFLOW.md)**ã€‚

### æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥

```powershell
# 1. æ‰¹é‡åˆ†æåˆ¶è¡¨
.\run_analyzer.ps1 -InputPath "path/to/pdfs" -Output "results.xlsx"

# 2. å•ç¯‡å…¨æµç¨‹ç²¾è¯»
python run_full_pipeline.py "paper.pdf"

# 3. æ‰¹é‡å…¨æµç¨‹ç²¾è¯» (è·³è¿‡å·²è¯»)
.\run_batch_pipeline.ps1 "path/to/pdfs"

# 4. ç»“æ„åŒ–åˆ†æ®µï¼ˆæ¨èä½¿ç”¨é»˜è®¤è¾¹ç•Œæ£€æµ‹æ¨¡å¼ï¼‰
python deepseek_segment_raw_md.py "pdf_raw_md/paper_raw.md"
# æˆ–ä½¿ç”¨ç›´æ¥åˆ†ç‰‡æ¨¡å¼ï¼ˆå°æ–‡ä»¶ï¼‰
python deepseek_segment_raw_md.py "pdf_raw_md/paper_raw.md" --direct

# 5. (å¯é€‰) æŠ½å–å‚è€ƒæ–‡çŒ®ï¼ˆåŸºäº segmented mdï¼‰
.\run_reference_extractor.ps1 "pdf_segmented_md\paper_segmented.md"

# 6. (å¯é€‰) å¼•ç”¨è¿½è¸ªï¼šä» references.xlsx åå‘å®šä½æ­£æ–‡å¼•ç”¨ä½ç½®
.\run_citation_tracer.ps1 "pdf_segmented_md\paper_segmented.md" "references\paper_references.xlsx"
```

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ .trae/skills/               # Skill å®šä¹‰æ–‡æ¡£
â”œâ”€â”€ pdf_raw_md/                 # Step 1 äº§ç‰©
â”œâ”€â”€ pdf_segmented_md/           # Step 3 äº§ç‰©
â”œâ”€â”€ deep_reading_results/       # Step 4 & 5 äº§ç‰© (æœ€ç»ˆæŠ¥å‘Š)
â”œâ”€â”€ deep_reading_steps/         # ç²¾è¯»å­ä»»åŠ¡ Python è„šæœ¬
â”œâ”€â”€ references/                 # (å¯é€‰) å‚è€ƒæ–‡çŒ®æŠ½å–/å¼•ç”¨è¿½è¸ªäº§ç‰©
â”œâ”€â”€ *.py / *.ps1                # å„æ­¥éª¤ä¸»æ§è„šæœ¬
â”œâ”€â”€ README_WORKFLOW.md          # è¯¦ç»†ä½¿ç”¨æ‰‹å†Œ
â””â”€â”€ requirements.txt
```
